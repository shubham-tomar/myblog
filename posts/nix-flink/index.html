<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><title>
         Apache Flink with Nix Flakes for Real-Time Data Streaming
        
    </title><meta content="Apache Flink with Nix Flakes for Real-Time Data Streaming" property=og:title><meta content="A guide to configuring a Nix flake environment for Apache Flink, enabling efficient real-time data streaming and processing." property=og:description><meta content="A guide to configuring a Nix flake environment for Apache Flink, enabling efficient real-time data streaming and processing." name=description><link href=/icon/favicon.png rel=icon type=image/png><link href=https://shubham-tomar.github.io/myblog/fonts.css rel=stylesheet><link href=https://shubham-tomar.github.io/myblog/atom.xml rel=alternate title=shubham-tomar type=application/atom+xml><link href=https://shubham-tomar.github.io/myblog/theme/light.css rel=stylesheet><link href=https://shubham-tomar.github.io/myblog/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://shubham-tomar.github.io/myblog/js/themetoggle.js></script><script>setTheme(getSavedTheme())</script><link href=https://shubham-tomar.github.io/myblog/main.css media=screen rel=stylesheet><body><div class=wrapper><div class=sidebar id=sidebar><button class=sb-toggle-button id=sidebarToggle>☰</button><nav class=table-of-contents><ul><li><a href=https://shubham-tomar.github.io/myblog/posts/nix-flink/#introduction>Introduction</a><li><a href=https://shubham-tomar.github.io/myblog/posts/nix-flink/#brief-about-nix-and-flakes>Brief about Nix and Flakes</a><li><a href=https://shubham-tomar.github.io/myblog/posts/nix-flink/#setting-up-the-nix-flake-for-apache-flink>Setting Up the Nix Flake for Apache Flink</a><li><a href=https://shubham-tomar.github.io/myblog/posts/nix-flink/#conclusion>Conclusion</a></ul></nav><blockquote>"Success is no accident. It is hard work, perseverance, learning, studying, sacrifice and most of all, love of what you are doing or learning to do." — Pelé</blockquote></div><div class=content id=content><header class=navbar><div class=main><a href=https://shubham-tomar.github.io/myblog/>shubham-tomar</a><div class=socials><a rel="me noopener noreferrer" class=social href=https://github.com/shubham-tomar/ target=_blank> <img alt=github src=https://shubham-tomar.github.io/myblog/social_icons/github.svg> </a><a rel="me noopener noreferrer" class=social href=https://linkedin.com/in/shubham-tomar-cs/ target=_blank> <img alt=linkedin src=https://shubham-tomar.github.io/myblog/social_icons/linkedin.svg> </a></div></div><nav><a href=https://shubham-tomar.github.io/myblog/posts style=margin-left:.7em>/posts</a><a href=https://shubham-tomar.github.io/myblog/projects style=margin-left:.7em>/projects</a><a href=https://shubham-tomar.github.io/myblog/about style=margin-left:.7em>/about</a><a href=https://shubham-tomar.github.io/myblog/tags style=margin-left:.7em>/tags</a><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://shubham-tomar.github.io/myblog/feather/sun.svg style=filter:invert(1)> <img alt=Dark id=moon-icon src=https://shubham-tomar.github.io/myblog/feather/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><main><article><div class=title><div class=page-header>Apache Flink with Nix Flakes for Real-Time Data Streaming<span class=primary-color style=font-size:1.6em>.</span></div><div class=meta>Posted on <time>2025-01-10</time></div></div><h1>Table of Contents</h1><ul><li><a href=https://shubham-tomar.github.io/myblog/posts/nix-flink/#introduction>Introduction</a><li><a href=https://shubham-tomar.github.io/myblog/posts/nix-flink/#brief-about-nix-and-flakes>Brief about Nix and Flakes</a><li><a href=https://shubham-tomar.github.io/myblog/posts/nix-flink/#setting-up-the-nix-flake-for-apache-flink>Setting Up the Nix Flake for Apache Flink</a><li><a href=https://shubham-tomar.github.io/myblog/posts/nix-flink/#conclusion>Conclusion</a></ul><section class=body><h1 id=introduction>Introduction</h1><p>In my current project, I worked with <a rel="me noopener noreferrer" href=https://flink.apache.org/ target=_blank>Apache Flink</a> for real-time analytics requirements. While there are various ways to set up a development environment, I prefer using Nix flakes. If you're not familiar with the Nix ecosystem, I highly recommend exploring it. Flink is a powerful stream processing framework designed for low-latency, high-throughput, and stateful computations, making it ideal for real-time analytics.<p>Setting up a consistent and reproducible development environment for Flink can be challenging due to its dependencies. This is where <a rel="me noopener noreferrer" href=https://nixos.org/ target=_blank>Nix</a>, a functional package manager, excels by providing declarative and reliable environment configurations. Utilizing Nix flakes, an experimental feature (but it is quite stable) that offers a standardized way to define and manage Nix projects.<p>In this guide, I'll walk you through setting up a Nix flake environment tailored for Apache Flink, facilitating efficient real-time data streaming and processing.<blockquote><p><strong>Note:</strong> This setup assumes you have Nix installed with flakes enabled. If not, refer to the <a href=https://nixos.org/download.html>Nix installation guide</a> and <a href=https://nixos.wiki/wiki/Flakes>flake documentation</a>. Or for a shortcut go with <a href=https://determinate.systems/posts/determinate-nix-installer/>Determinate Nix Installer</a></blockquote><h1 id=brief-about-nix-and-flakes>Brief about Nix and Flakes</h1><p>Nix is a powerful package manager that enables reproducible builds and declarative configurations. It can function as a package manager, a functional scripting language, or even as an operating system (NixOS). Nix ensures that your development environment is consistent across different systems, eliminating the "it works on my machine" problem.<p>Nix flakes introduce a standardized and declarative way to define and manage Nix projects, packages, dependencies, and development environments. They simplify the packaging, versioning, and sharing of Nix projects by encapsulating them into well-structured, self-contained units of code or configuration.<h1 id=setting-up-the-nix-flake-for-apache-flink>Setting Up the Nix Flake for Apache Flink</h1><p>To set up your development environment with Nix flakes, follow these steps:<ol><li><strong>Install Nix:</strong> If you haven't installed Nix yet, Use below command to install nix and enable flakes in your system, this might take sometime though</ol><pre style=background:#0f1419;color:#bfbab0><code><span>curl --proto '=https' --tlsv1.2 -sSf -L https://install.determinate.systems/nix | sh -s -- install
</span></code></pre><ol start=3><li><strong>Create a New Directory for Your Project:</strong> Open your terminal and execute:</ol><pre class=language-bash data-lang=bash style=background:#0f1419;color:#bfbab0><code class=language-bash data-lang=bash><span style=color:#ffb454>mkdir</span><span> flink-nix-setup
</span><span style=color:#f07178>cd</span><span> flink-nix-setup
</span></code></pre><ol start=4><li><strong>Initialize a New Flake:</strong> Run the following command to create a new flake:</ol><pre class=language-bash data-lang=bash style=background:#0f1419;color:#bfbab0><code class=language-bash data-lang=bash><span style=color:#ffb454>nix</span><span> flake init</span><span style=color:#f29718> -t</span><span> github:the-nix-way/dev-templates#default
</span></code></pre><p>This command initializes your project with a template that includes a flake.nix file, which you can customize to suit your needs.<ol start=5><li><strong>Configure the flake.nix File:</strong> Replace the contents of the flake.nix file with the following configuration:</ol><ul><li>I have added flink, jdk and maven for building java projects but you can add as many pkgs as you need.</ul><pre class=language-nix data-lang=nix style=background:#0f1419;color:#bfbab0><code class=language-nix data-lang=nix><span>{
</span><span>  </span><span style=color:#ffb454>description </span><span style=color:#f29668>= </span><span style=color:#c2d94c>"Apache Flink Development Environment with Nix Flakes"</span><span style=color:#bfbab0cc>;
</span><span>
</span><span>  </span><span style=color:#ffb454>inputs </span><span style=color:#f29668>= </span><span>{
</span><span>    </span><span style=color:#ffb454>nixpkgs</span><span>.</span><span style=color:#ffb454>url </span><span style=color:#f29668>= </span><span style=color:#c2d94c>"github:NixOS/nixpkgs/nixpkgs-unstable"</span><span style=color:#bfbab0cc>;
</span><span>    </span><span style=color:#ffb454>flake-utils</span><span>.</span><span style=color:#ffb454>url </span><span style=color:#f29668>= </span><span style=color:#c2d94c>"github:numtide/flake-utils"</span><span style=color:#bfbab0cc>;
</span><span>  }</span><span style=color:#bfbab0cc>;
</span><span>
</span><span>  </span><span style=color:#ffb454>outputs </span><span style=color:#f29668>= </span><span>{ </span><span style=color:#f29718>self</span><span style=color:#f29668>, </span><span style=color:#f29718>flake-utils</span><span style=color:#f29668>, </span><span style=color:#f29718>nixpkgs </span><span>}:
</span><span>    </span><span style=color:#f29718>flake-utils</span><span style=color:#f29668>.</span><span style=color:#f29718>lib</span><span style=color:#f29668>.</span><span style=color:#f29718>eachDefaultSystem </span><span>(</span><span style=color:#f29718>system</span><span>:
</span><span>      </span><span style=color:#ff7733>let
</span><span>        </span><span style=color:#ffb454>pkgs </span><span style=color:#f29668>= </span><span style=color:#f07178>import </span><span style=color:#f29718>nixpkgs </span><span>{ </span><span style=color:#ff7733>inherit </span><span style=color:#ffb454>system</span><span style=color:#bfbab0cc>; </span><span>}</span><span style=color:#bfbab0cc>;
</span><span>        </span><span style=color:#ffb454>customFlink </span><span style=color:#f29668>= </span><span style=color:#f29718>pkgs</span><span style=color:#f29668>.</span><span style=color:#f29718>stdenv</span><span style=color:#f29668>.</span><span style=color:#f29718>mkDerivation </span><span>{
</span><span>          </span><span style=color:#ffb454>pname </span><span style=color:#f29668>= </span><span style=color:#c2d94c>"flink"</span><span style=color:#bfbab0cc>;
</span><span>          </span><span style=color:#ffb454>version </span><span style=color:#f29668>= </span><span style=color:#c2d94c>"1.14.4"</span><span style=color:#bfbab0cc>;
</span><span>          </span><span style=color:#ffb454>src </span><span style=color:#f29668>= </span><span style=color:#f29718>pkgs</span><span style=color:#f29668>.</span><span style=color:#f29718>fetchurl </span><span>{
</span><span>            </span><span style=color:#ffb454>url </span><span style=color:#f29668>= </span><span style=color:#c2d94c>"https://downloads.apache.org/flink/flink-1.14.4/flink-1.14.4-bin-scala_2.12.tgz"</span><span style=color:#bfbab0cc>;
</span><span>            </span><span style=color:#ffb454>sha256 </span><span style=color:#f29668>= </span><span style=color:#c2d94c>"sha256-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"</span><span style=color:#bfbab0cc>;
</span><span>          }</span><span style=color:#bfbab0cc>;
</span><span>          </span><span style=color:#ffb454>nativeBuildInputs </span><span style=color:#f29668>= </span><span>[ </span><span style=color:#f29718>pkgs</span><span style=color:#f29668>.</span><span style=color:#f29718>unzip </span><span>]</span><span style=color:#bfbab0cc>;
</span><span>          </span><span style=color:#ffb454>installPhase </span><span style=color:#f29668>= </span><span style=color:#c2d94c>''
</span><span style=color:#c2d94c>            mkdir -p $out
</span><span style=color:#c2d94c>            tar -xzf $src --strip-components=1 -C $out
</span><span style=color:#c2d94c>          ''</span><span style=color:#bfbab0cc>;
</span><span>        }</span><span style=color:#bfbab0cc>;
</span><span>      </span><span style=color:#ff7733>in </span><span>{
</span><span>        </span><span style=color:#ffb454>devShell </span><span style=color:#f29668>= </span><span style=color:#f29718>pkgs</span><span style=color:#f29668>.</span><span style=color:#f29718>mkShell </span><span>{
</span><span>          </span><span style=color:#ffb454>name </span><span style=color:#f29668>= </span><span style=color:#c2d94c>"flink-streaming-env"</span><span style=color:#bfbab0cc>;
</span><span>          </span><span style=color:#ffb454>buildInputs </span><span style=color:#f29668>= </span><span>[
</span><span>            </span><span style=color:#f29718>pkgs</span><span style=color:#f29668>.</span><span style=color:#f29718>openjdk17
</span><span>            </span><span style=color:#f29718>pkgs</span><span style=color:#f29668>.</span><span style=color:#f29718>maven
</span><span>            </span><span style=color:#f29718>customFlink
</span><span>          ]</span><span style=color:#bfbab0cc>;
</span><span>
</span><span>          </span><span style=color:#ffb454>shellHook </span><span style=color:#f29668>= </span><span style=color:#c2d94c>''
</span><span style=color:#c2d94c>            echo "Welcome to the Flink Streaming Development Environment!"
</span><span style=color:#c2d94c>            java -version
</span><span style=color:#c2d94c>            export JVM_ARGS="--add-opens=java.base/java.util=ALL-UNNAMED"
</span><span style=color:#c2d94c>          ''</span><span style=color:#bfbab0cc>;
</span><span>        }</span><span style=color:#bfbab0cc>;
</span><span>
</span><span>        </span><span style=color:#ffb454>packages</span><span>.</span><span style=color:#ffb454>default </span><span style=color:#f29668>= </span><span style=color:#f29718>pkgs</span><span style=color:#f29668>.</span><span style=color:#f29718>writeShellScriptBin </span><span style=color:#c2d94c>"run-flink-job" ''
</span><span style=color:#c2d94c>          LOG_DIR=~/flink-logs
</span><span style=color:#c2d94c>          mkdir -p "$LOG_DIR"
</span><span style=color:#c2d94c>
</span><span style=color:#c2d94c>          export FLINK_LOG_DIR="$LOG_DIR"
</span><span style=color:#c2d94c>
</span><span style=color:#c2d94c>          </span><span style=font-style:italic;color:#bfbab0>${</span><span style=font-style:italic;color:#f29718>customFlink</span><span style=font-style:italic;color:#bfbab0>}</span><span style=color:#c2d94c>/bin/start-cluster.sh
</span><span style=color:#c2d94c>          echo "Running Flink Job..."
</span><span style=color:#c2d94c>          FLINK_BIN=</span><span style=font-style:italic;color:#bfbab0>${</span><span style=font-style:italic;color:#f29718>customFlink</span><span style=font-style:italic;color:#bfbab0>}</span><span style=color:#c2d94c>/bin/flink
</span><span style=color:#c2d94c>          FLINK_JAR_PATH=./flink-streaming-project/target/flink-streaming-project-1.0-SNAPSHOT.jar
</span><span style=color:#c2d94c>          if [ ! -f "$FLINK_JAR_PATH" ]; then
</span><span style=color:#c2d94c>            echo "Error: Flink JAR file not found at $FLINK_JAR_PATH. Please build the project first."
</span><span style=color:#c2d94c>            exit 1
</span><span style=color:#c2d94c>          fi
</span><span style=color:#c2d94c>          export JVM_ARGS="--add-opens=java.base/java.util=ALL-UNNAMED"
</span><span style=color:#c2d94c>          $FLINK_BIN run "$FLINK_JAR_PATH"
</span><span style=color:#c2d94c>
</span><span style=color:#c2d94c>          </span><span style=font-style:italic;color:#bfbab0>${</span><span style=font-style:italic;color:#f29718>customFlink</span><span style=font-style:italic;color:#bfbab0>}</span><span style=color:#c2d94c>/bin/stop-cluster.sh
</span><span style=color:#c2d94c>        ''</span><span style=color:#bfbab0cc>;
</span><span>      }
</span><span>    )</span><span style=color:#bfbab0cc>;
</span><span>}
</span><span>
</span></code></pre><blockquote><p><strong>Important:</strong> Update the sha256 value with the correct hash for the Flink binary. You can obtain this by downloading the file and running or you can just to <code>nix develop</code> and nix will tell you the correct one to use.</blockquote><ul><li>After setting up your flake.nix file you can run the command <code>nix develop</code> which will download all the pkgs and will provide you a dev shell.<li>Note that running nix for the first time for any project might take some time, so be a little paitient</ul><h1 id=conclusion>Conclusion</h1><p>I hope after this you will be able to set a nix dev shell which will have flink, jdk, maven included. Fell free to add/modify this tempalte as per your need.</section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=https://shubham-tomar.github.io/myblog/tags/blog/>blog</a><li><a href=https://shubham-tomar.github.io/myblog/tags/flink/>Flink</a><li><a href=https://shubham-tomar.github.io/myblog/tags/nix/>Nix</a></ul></nav></div></article></main></div></div><script src=https://shubham-tomar.github.io/myblog/js/sb-toggle.js></script>